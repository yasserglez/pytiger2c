\documentclass{article}

\usepackage[spanish]{babel}
\usepackage[utf8]{inputenc}
\usepackage{fullpage}
\usepackage{fancyvrb}
\usepackage{color}

\input{common/pygments}

\title{
    \LARGE{PyTiger2C} \\
    \Large{Anotaciones sobre el código generado}
}

\author{
    Yasser González Fernández \\
    \small{yglez@uh.cu}
    \and
    Ariel Hernández Amador \\
    \small{gnuaha7@uh.cu}
}

\date{}

\begin{document}

\maketitle

\thispagestyle{empty}

\newpage

\setcounter{page}{1}

\section{Introducción}

Nuestro proyecto se propone desarrollar una implementación de un compilador para
el lenguaje de programación Tiger que genere código \emph{C}. Posteriormente, el
código \emph{C} generado se compilará con un compilador de \emph{C} para generar
un ejecutable para una plataforma específica. El código \emph{C} generado por
nuestro compilador será conforme al \emph{standard} \emph{ISO/IEC 9899:1999},
comúnmente conocido como \emph{C99}, lo cual garantiza que pueda ser procesado
por cualquier compilador de \emph{C} conforme a dicho \emph{standard}.

Este documento brinda una descripción general de la estructura y las
características del código \emph{C} que generará nuestro compilador.

\section{Identificadores}

Un identificador en \textit{Tiger} es una secuencia de letras, dígitos y
\textit{underscores}, comenzando siempre por una letra. Según la descripción
anterior, un identificador en \textit{Tiger} es completamente válido en el
lenguaje \textit{C}.

Nuestro código \textit{C} generado tratará de asignarle a un identificador
válido de \textit{Tiger} otro con el mismo nombre en \textit{C}, siempre que
este no coincida con una palabra reservada del propio lenguaje \textit{C} o con
otro identificador definido anteriormente. En caso de que el identificador no
sea válido, se le añadirán \textit{underscores} al final hasta lograr un
identificador válido.

\section{Comentarios}

Los comentarios en \textit{Tiger} puede aparecer entre cualquier par
\textit{tokens} del lenguaje, enmarcándose entre \texttt{/*} y \texttt{*/}. El
código \textit{C} generado por nuestro compilador no reflejará los comentarios
del programa \textit{Tiger} original.

\section{Declaraciones de tipos}

\subsection{Tipos predefinidos}

El lenguaje \textit{Tiger} cuenta con dos tipos predefinidos: \texttt{int} para
los números enteros y \texttt{string} para las cadenas de caracteres. 

El código \textit{C} generado por nuestro compilador creará una variable de
tipo \texttt{int64\_t} para cada variable de tipo \texttt{int} en el programa
\textit{Tiger} de origen.

Por otra parte, a las variables de tipo \texttt{string} de un programa
\textit{Tiger} se les asociará una estructura llamada \texttt{string} cuya
definición se muestra a continuación.

\begin{quote}
\input{codegen/c-string}
\end{quote}

El campo \texttt{data} corresponde a la secuencia de caracteres de la cadena y
el campo \texttt{length} almacena a la longitud de la misma.

\subsection{\emph{Records}}

En \textit{Tiger} los \textit{record} son definidos por una lista de sus campos
encerrados entre llaves. Cada elemento de esta lista corresponde a la
descripción de un campo y tiene la forma \verb|field_name: field_type| donde
\texttt{field\_type} es un identificador definido con anterioridad o de el
propio tipo del \emph{record}.

El código \textit{C} generado por nuestro compilador contendrá una estructura
para cada \textit{record} definido en el programa \textit{Tiger} de origen. 
Campo de la estructura corresponderá con uno equivalente en el \textit{record}
definido en \emph{Tiger}. En caso de que algún campo tenga un nombre no válido
en \emph{C}, se seguirá la misma estrategia de renombramiento que en el caso de
los identificadores.

El siguiente ejemplo muestra el código \textit{C} generado para la definición
del \textit{record} \texttt{people} en \emph{Tiger}.

\begin{quote}
\input{codegen/tig-people}
\end{quote}

\begin{quote}
\input{codegen/c-people}
\end{quote}

El lenguaje \textit{Tiger} permite la declaración de \textit{records}
mutuamente recursivos, que son definidos en función de ellos mismos. Esta
característica de \textit{Tiger} no trae ninguna complicación adicional al
código \textit{C} equivalente, pues las estructuras de \textit{C} también
pueden contener campos del mismo tipo de la estructura que se está definiendo.

El siguiente ejemplo muestra el código \textit{C} generado equivalente a la
definición de \textit{record} correspondiente a un árbol binario
(\texttt{bianry\_tree}).

\begin{quote}
\input{codegen/tig-binary_tree}
\end{quote}

\begin{quote}
\input{codegen/c-binary_tree}
\end{quote}

\subsection{\emph{Arrays}}

En el lenguaje \textit{Tiger} es posible declarar \textit{arrays} de cualquier
tipo previamente declarado utilizando la sintaxis \texttt{array of}
\textit{type\_name}. Nuestro código \textit{C} creará una estructura
semejante a la usada para el manejo del tipo básico \texttt{string} que
almacenará en \texttt{data} un puntero al primer elemento de la secuencia de
datos y en \texttt{length} la cantidad de elementos de el mismo.

El siguiente ejemplo ilustra la creación de un \textit{array} en \textit{Tiger}
y el código \textit{C} equivalente generado.

\begin{quote}
\input{codegen/tig-integers}
\end{quote}

\begin{quote}
\input{codegen/c-integers}
\end{quote}

\section{Funciones}

% Una función en Tiger se traduce a una función en C que recibe su 
% scope padre y todos sus argumentos. El valor de retorno será del tipo
% correspondiente para las funciones y void apra los procedimientos.

% Para cada scope se declara una estructura funcion_scope que tiene
% una referencia al scope padre y campos para todas las variables
% declaradas en el scope. 

% Lo primero que hace el código C de una función es crear su scope.

% Poner ejemplo del código Tiger de una función y su traducción a C.

% Explicar funcionamiento de esta técnica para funciones anidadas
% y funciones recursivas.

\section{Estructura general del archivo \emph{C}}

El archivo de un programa \textit{C} generado como equivalente de un programa en
\textit{Tiger} tendrá la siguiente estructura en su código.

\begin{enumerate}
  \item \texttt{\#include}s: En esta sección se incluyen las cabeceras
  correspondientes a librerías de \textit{C} que serán usadas en el programa
  generado.
  \item Declaraciones de Tipos
  	\begin{enumerate}
      \item Tipos de la  \textit{Biblioteca Standard}: En esta parte del código se
      encontrarán las declaraciones de los tipos \texttt{string} e \texttt{int}
      además de cualquier tipo que sea necesitado por la librería standard.
      \item Tipos del Programa: En esta parte del código se encontrarán
      las declaraciones de los tipos definidos en el programa de origen.
  	\end{enumerate}
  \item Declaración de los \textit{Scopes}. En esta parte del código se
  encontrarán las declaraciones de los Scopes unidos a cada función del
  programa \textit{Tiger} de origen.
  \item Prototipos de las funciones: Al colocar los prototipos en esta parte
  del código se garantiza que las funciones serán accesible para las que los
  necesiten sin importar el orden.
	\begin{enumerate}
      \item Prototipos de las funciones de la \textit{Biblioteca Standard}: En
      esta parte del código se encuentran la descripción de todas las funciones
      de la librería standard.
      \item Prototipos de las funciones del programa: En esta parte del código
      se muestran la descripción de las funciones que son definidas en el
      programa \textit{Tiger} original.
    \end{enumerate}
  \item Cuerpo de las funciones
 	\begin{itemize}
          \item Cuerpo de las funciones de la biblioteca standard: En esta
          parte del código se encontrarán las implementaciones de las funciones
          de la biblioteca standard de \textit{Tiger}.
          \item Cuerpo de las funciones del programa: En esta parte del código
          estará el código \textit{C} equivalente a cada función definida en el
          programa \textit{Tiger} de origen.
     \end{itemize}
  \item Función \textit{main}: Esta función recibe un trato especial y en su
  cuerpo se encontrará el código \textit{C} equivalente las instrucciones que
  no se encuentran dentro de una declaración de función o de 
  \item tipo. 
    
       
\end{enumerate}
% 6. Función main.

\end{document}